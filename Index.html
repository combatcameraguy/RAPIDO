<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAPIDO Handyman Quote Request</title>
    
    <!-- PWA Metadata -->
    <meta name="description" content="Request a quote for professional handyman services in Lawton, Oklahoma">
    <meta name="theme-color" content="#d97706">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="RAPIDO Quote">
    
    <!-- html2pdf.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Firebase SDK v9 (compat mode for easier usage) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Firebase Configuration -->
    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDvYPFm6PtVXKc01Uo1_CMGqrWFp_oXbm0",
            authDomain: "rapido-dashboard.firebaseapp.com",
            projectId: "rapido-dashboard",
            storageBucket: "rapido-dashboard.firebasestorage.app",
            messagingSenderId: "917389932203",
            appId: "1:917389932203:web:dac142f05ed07d21ee69ee"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 950px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 5px;
            font-weight: bold;
            letter-spacing: 1px;
        }
        
        .header .subtitle {
            font-size: 16px;
            opacity: 0.95;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .info-banner {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #d97706;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .info-banner h3 {
            color: #92400e;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .info-banner p {
            color: #92400e;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }
        
        .info-banner p:last-child {
            margin-bottom: 0;
        }
        
        .disclaimer {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 25px;
        }
        
        .disclaimer p {
            color: #856404;
            font-size: 13px;
            line-height: 1.6;
            margin: 0;
        }
        
        .error-message, .success-message {
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            font-size: 16px;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .error-message {
            background: #f8d7da;
            border: 3px solid #dc3545;
            color: #721c24;
        }
        
        .success-message {
            background: #d4edda;
            border: 3px solid #28a745;
            color: #155724;
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.3);
        }
        
        .success-message strong {
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }
        
        .error-message.show, .success-message.show {
            display: block;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #d97706;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d97706;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
            font-size: 15px;
        }
        
        label .required {
            color: #e74c3c;
        }
        
        label .price-note {
            font-weight: normal;
            color: #666;
            font-size: 13px;
        }
        
        select, input[type="number"], input[type="text"], input[type="email"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #d97706;
        }
        
        select:disabled, input:disabled {
            background-color: #e9ecef;
            cursor: not-allowed;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .checkbox-group:hover {
            border-color: #d97706;
            background: #fef3c7;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }
        
        .sub-options {
            margin-left: 32px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-left: 3px solid #d97706;
            border-radius: 4px;
            display: none;
        }
        
        .sub-options.show {
            display: block;
        }
        
        .price-summary {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            padding: 25px;
            border-radius: 8px;
            margin-top: 25px;
            border: 3px solid #d97706;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.2);
        }
        
        .price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 16px;
            color: #92400e;
        }
        
        .price-row.total {
            font-size: 28px;
            font-weight: bold;
            padding-top: 15px;
            border-top: 3px solid #d97706;
            margin-top: 15px;
            color: #92400e;
        }
        
        .itemized-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #d97706;
        }
        
        .itemized-list h3 {
            color: #d97706;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .itemized-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 15px;
        }
        
        .itemized-item:last-child {
            border-bottom: none;
        }
        
        .itemized-item .item-name {
            color: #333;
            font-weight: 500;
        }
        
        .itemized-item .item-price {
            color: #d97706;
            font-weight: 600;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #b45309 0%, #d97706 100%);
            color: white;
            padding: 16px 32px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 12px rgba(217, 119, 6, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(217, 119, 6, 0.4);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .radio-group {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }
        
        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .radio-option:hover {
            border-color: #d97706;
            background: #fef3c7;
        }
        
        .radio-option input[type="radio"] {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .radio-option label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                border-radius: 8px;
            }
            
            .content {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .price-row.total {
                font-size: 24px;
            }
            
            .radio-group {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔧 RAPIDO</h1>
            <div class="subtitle">Professional Handyman Services</div>
            <p>Lawton, Oklahoma | 6 Years Experience | Get Your Quote Now</p>
        </div>
        
        <div class="content">
            <!-- Success Message -->
            <div id="successMessage" class="success-message">
                <strong>✓ Quote Request Submitted Successfully!</strong>
                We'll review your request and get back to you within 24 hours with a detailed quote.
            </div>
            
            <!-- Error Message -->
            <div id="errorMessage" class="error-message">
                <span id="errorText"></span>
            </div>
            
            <!-- Info Banner -->
            <div class="info-banner">
                <h3>🏠 Welcome to RAPIDO Handyman Services!</h3>
                <p>With 6 years of experience serving Lawton, Oklahoma, we provide quality handyman services at competitive prices.</p>
                <p><strong>Pricing:</strong> $30/hour with a 2-hour minimum for most work. Larger jobs are bid by the job.</p>
                <p><strong>Our Services Include:</strong> Light carpentry, painting, make-ready, property management, hot water systems, water softener systems, light electrical work, window pane and screen replacement, door installation, curb appeal and cosmetic work (residential & commercial), dryer vent clean out and replace, and more!</p>
                <p>📞 Fast Response | 💯 Quality Work | 💰 Fair Pricing</p>
            </div>
            
            <!-- Disclaimer -->
            <div class="disclaimer">
                <p><strong>Note:</strong> This is an estimate calculator. Final pricing may vary based on project specifics, materials needed, and site conditions. A free on-site consultation will be provided for projects over $500.</p>
            </div>
            
            <form id="quoteForm">
                <!-- Client Information -->
                <div class="section">
                    <div class="section-title">📋 Client Information</div>
                    
                    <div class="form-group">
                        <label>Your Name <span class="required">*</span></label>
                        <input type="text" id="clientName" required placeholder="John Smith">
                    </div>
                    
                    <div class="form-group">
                        <label>Email Address <span class="required">*</span></label>
                        <input type="email" id="clientEmail" required placeholder="john@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number</label>
                        <input type="text" id="clientPhone" placeholder="(580) 555-1234">
                    </div>
                    
                    <div class="form-group">
                        <label>Service Address</label>
                        <input type="text" id="serviceAddress" placeholder="123 Main St, Lawton, OK">
                    </div>
                    
                    <div class="form-group">
                        <label>Project Name/Description <span class="required">*</span></label>
                        <input type="text" id="projectName" required placeholder="e.g., Kitchen Cabinet Installation">
                    </div>
                    
                    <div class="form-group">
                        <label>Additional Details</label>
                        <textarea id="projectDescription" placeholder="Describe your project in detail... materials available, timeline preferences, special requirements, etc."></textarea>
                    </div>
                </div>
                
                <!-- Home Interior Services -->
                <div class="section">
                    <div class="section-title">🏠 Home Interior Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="kitchenCabinets">
                        <label>Kitchen Cabinet Installation/Hanging <span class="price-note">($45 per cabinet)</span></label>
                    </div>
                    <div id="kitchenCabinetsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Cabinets</label>
                            <input type="number" id="cabinetCount" min="1" max="20" value="5">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="bathroomWork">
                        <label>Bathroom Repairs/Updates <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="bathroomWorkOptions" class="sub-options">
                        <div class="form-group">
                            <label>Type of Work</label>
                            <select id="bathroomType">
                                <option value="minor">Minor Repairs (Faucet, Toilet, etc.) - $60</option>
                                <option value="moderate">Moderate Updates (Vanity, Fixtures) - $150</option>
                                <option value="major">Major Work (Multiple Items) - $300</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="sheetrock">
                        <label>Sheetrock/Drywall Repair <span class="price-note">($60-$360)</span></label>
                    </div>
                    <div id="sheetrockOptions" class="sub-options">
                        <div class="form-group">
                            <label>Repair Size</label>
                            <select id="sheetrockSize">
                                <option value="small">Small Hole/Patch (< 6") - $60</option>
                                <option value="medium">Medium Repair (6"-24") - $120</option>
                                <option value="large">Large Repair/Multiple Areas - $240</option>
                                <option value="wall">Full Wall - $360</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="interiorPainting">
                        <label>Interior Painting <span class="price-note">($150-$900)</span></label>
                    </div>
                    <div id="interiorPaintingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Area to Paint</label>
                            <select id="interiorPaintArea">
                                <option value="room">Single Room - $150</option>
                                <option value="tworooms">Two Rooms - $270</option>
                                <option value="multiple">Multiple Rooms (3-4) - $480</option>
                                <option value="whole">Whole House Interior - $900</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Electrical Services -->
                <div class="section">
                    <div class="section-title">⚡ Electrical Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="floodlights">
                        <label>Floodlight Installation <span class="price-note">($75 per light)</span></label>
                    </div>
                    <div id="floodlightsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Floodlights</label>
                            <input type="number" id="floodlightCount" min="1" max="10" value="2">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="lightFixtures">
                        <label>Light Fixture Installation/Replacement <span class="price-note">($50 per fixture)</span></label>
                    </div>
                    <div id="lightFixturesOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Fixtures</label>
                            <input type="number" id="fixtureCount" min="1" max="15" value="3">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="switches">
                        <label>Wall Switch Replacement <span class="price-note">($60 minimum - 2 hour minimum)</span></label>
                    </div>
                    <div id="switchesOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Switches</label>
                            <input type="number" id="switchCount" min="1" max="20" value="2">
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="outlets">
                        <label>Outlet/Socket Installation/Replacement <span class="price-note">($60 minimum - 2 hour minimum)</span></label>
                    </div>
                    <div id="outletsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Number of Outlets</label>
                            <input type="number" id="outletCount" min="1" max="20" value="2">
                        </div>
                    </div>
                </div>
                
                <!-- Plumbing Services -->
                <div class="section">
                    <div class="section-title">🔧 Plumbing Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="plumbing">
                        <label>Plumbing Repairs <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="plumbingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Type of Plumbing Work</label>
                            <select id="plumbingType">
                                <option value="minor">Minor Leak/Faucet Repair - $60</option>
                                <option value="fixture">Fixture Replacement - $120</option>
                                <option value="drain">Drain Cleaning/Repair - $90</option>
                                <option value="major">Major Repair/Multiple Issues - $300</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Outdoor Services -->
                <div class="section">
                    <div class="section-title">🌳 Outdoor Services</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="exteriorPainting">
                        <label>Exterior Painting <span class="price-note">($300-$1,500)</span></label>
                    </div>
                    <div id="exteriorPaintingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Exterior Paint Job Size</label>
                            <select id="exteriorPaintSize">
                                <option value="trim">Trim/Accent Only - $300</option>
                                <option value="small">Small Structure (Shed, Garage Door) - $450</option>
                                <option value="partial">Partial House - $750</option>
                                <option value="full">Full House Exterior - $1,500</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="woodFence">
                        <label>Wood Fence Building <span class="price-note">($20-$30 per linear foot)</span></label>
                    </div>
                    <div id="woodFenceOptions" class="sub-options">
                        <div class="form-group">
                            <label>Fence Length (Linear Feet)</label>
                            <input type="number" id="fenceLength" min="10" max="500" value="50">
                        </div>
                        <div class="form-group">
                            <label>Fence Type</label>
                            <select id="fenceType">
                                <option value="basic">Basic Privacy Fence - $20/ft</option>
                                <option value="standard">Standard Quality - $25/ft</option>
                                <option value="premium">Premium/Custom - $30/ft</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="treeService">
                        <label>Small Tree Services (Trimming/Removal) <span class="price-note">($120-$450)</span></label>
                    </div>
                    <div id="treeServiceOptions" class="sub-options">
                        <div class="form-group">
                            <label>Tree Service Type</label>
                            <select id="treeServiceType">
                                <option value="trimming">Tree Trimming (Small) - $120</option>
                                <option value="shrubs">Multiple Shrubs/Small Trees - $180</option>
                                <option value="removal">Small Tree Removal - $300</option>
                                <option value="major">Major Tree Work - $450</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="flowerbeds">
                        <label>Flowerbed Maintenance/Installation <span class="price-note">($60-$300)</span></label>
                    </div>
                    <div id="flowerbedsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Flowerbed Work</label>
                            <select id="flowerbedType">
                                <option value="maintenance">Basic Maintenance/Weeding - $60</option>
                                <option value="refresh">Refresh/New Plants - $120</option>
                                <option value="new">New Flowerbed Installation - $210</option>
                                <option value="multiple">Multiple Beds - $300</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Yard Work Services -->
                <div class="section">
                    <div class="section-title">🌱 Lawn & Yard Work</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="mowing">
                        <label>Lawn Mowing & Edging <span class="price-note">($60-$120 per visit)</span></label>
                    </div>
                    <div id="mowingOptions" class="sub-options">
                        <div class="form-group">
                            <label>Lawn Size</label>
                            <select id="lawnSize">
                                <option value="small">Small Yard (< 5,000 sq ft) - $60</option>
                                <option value="medium">Medium Yard (5,000-10,000 sq ft) - $75</option>
                                <option value="large">Large Yard (10,000-15,000 sq ft) - $90</option>
                                <option value="xlarge">Extra Large Yard (> 15,000 sq ft) - $120</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Frequency (optional)</label>
                            <select id="mowingFrequency">
                                <option value="onetime">One-Time Service</option>
                                <option value="weekly">Weekly (10% discount)</option>
                                <option value="biweekly">Bi-Weekly (5% discount)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="yardCleanup">
                        <label>General Yard Cleanup <span class="price-note">($60-$240)</span></label>
                    </div>
                    <div id="yardCleanupOptions" class="sub-options">
                        <div class="form-group">
                            <label>Cleanup Scope</label>
                            <select id="cleanupScope">
                                <option value="light">Light Cleanup (Leaves, Debris) - $60</option>
                                <option value="moderate">Moderate Cleanup - $150</option>
                                <option value="heavy">Heavy Cleanup - $240</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Options -->
                <div class="section">
                    <div class="section-title">⚡ Additional Options</div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="urgent">
                        <label><strong>🚨 URGENT SERVICE (Next Day) +25%</strong></label>
                    </div>
                    
                    <div class="checkbox-group">
                        <input type="checkbox" id="materials">
                        <label>Materials Needed (We'll purchase and add receipt to invoice)</label>
                    </div>
                    <div id="materialsOptions" class="sub-options">
                        <div class="form-group">
                            <label>Estimated Materials Cost</label>
                            <input type="number" id="materialsCost" min="0" max="10000" value="0" step="10" placeholder="Enter estimated cost">
                        </div>
                    </div>
                </div>
                
                <!-- Price Summary -->
                <div class="price-summary">
                    <div class="price-row">
                        <span>Base Services:</span>
                        <span id="basePrice">$0</span>
                    </div>
                    <div class="price-row">
                        <span>Materials:</span>
                        <span id="materialsPrice">$0</span>
                    </div>
                    <div class="price-row" id="urgentRow" style="display: none;">
                        <span>Urgent Service Fee (+25%):</span>
                        <span id="urgentPrice">$0</span>
                    </div>
                    <div class="price-row" id="discountRow" style="display: none; color: #28a745;">
                        <span>Recurring Service Discount:</span>
                        <span id="discountAmount">-$0</span>
                    </div>
                    <div class="price-row total">
                        <span>ESTIMATED TOTAL:</span>
                        <span id="totalPrice">$0</span>
                    </div>
                </div>
                
                <!-- Itemized List -->
                <div class="itemized-list">
                    <h3>📝 Selected Services Breakdown</h3>
                    <div id="itemizedContainer">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            Select services above to see itemized breakdown
                        </div>
                    </div>
                </div>
                
                <!-- Submit Button -->
                <button type="submit" class="btn-primary" id="submitBtn">
                    Submit Quote Request
                </button>
            </form>
        </div>
    </div>
    
    <script>
        // Add click handlers to all checkbox groups after page loads
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.checkbox-group').forEach(group => {
                group.addEventListener('click', function(e) {
                    // Only toggle if we didn't click directly on the checkbox or label
                    if (e.target.type !== 'checkbox' && e.target.tagName !== 'LABEL') {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        if (checkbox) {
                            checkbox.checked = !checkbox.checked;
                            checkbox.dispatchEvent(new Event('change'));
                        }
                    }
                });
            });
        });
        
        // Show/hide sub-options based on checkbox state
        document.querySelectorAll('.checkbox-group input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function(e) {
                const optionsDiv = document.getElementById(this.id + 'Options');
                if (optionsDiv) {
                    if (this.checked) {
                        optionsDiv.classList.add('show');
                    } else {
                        optionsDiv.classList.remove('show');
                    }
                }
                calculatePrice();
                updateItemizedList();
            });
        });
        
        // Calculate pricing
        function calculatePrice() {
            let baseTotal = 0;
            
            // Kitchen Cabinets
            if (document.getElementById('kitchenCabinets').checked) {
                const count = parseInt(document.getElementById('cabinetCount').value) || 5;
                // $45 per cabinet (1.5 hours each at $30/hr)
                baseTotal += count * 45;
            }
            
            // Bathroom Work
            if (document.getElementById('bathroomWork').checked) {
                const type = document.getElementById('bathroomType').value;
                const prices = { minor: 60, moderate: 150, major: 300 };
                baseTotal += prices[type] || 0;
            }
            
            // Sheetrock
            if (document.getElementById('sheetrock').checked) {
                const size = document.getElementById('sheetrockSize').value;
                const prices = { small: 60, medium: 120, large: 240, wall: 360 };
                baseTotal += prices[size] || 0;
            }
            
            // Interior Painting
            if (document.getElementById('interiorPainting').checked) {
                const area = document.getElementById('interiorPaintArea').value;
                const prices = { room: 150, tworooms: 270, multiple: 480, whole: 900 };
                baseTotal += prices[area] || 0;
            }
            
            // Floodlights
            if (document.getElementById('floodlights').checked) {
                const count = parseInt(document.getElementById('floodlightCount').value) || 2;
                baseTotal += count * 75;
            }
            
            // Light Fixtures
            if (document.getElementById('lightFixtures').checked) {
                const count = parseInt(document.getElementById('fixtureCount').value) || 3;
                baseTotal += count * 50;
            }
            
            // Switches
            if (document.getElementById('switches').checked) {
                const count = parseInt(document.getElementById('switchCount').value) || 2;
                baseTotal += 60; // 2-hour minimum
            }
            
            // Outlets
            if (document.getElementById('outlets').checked) {
                const count = parseInt(document.getElementById('outletCount').value) || 2;
                baseTotal += 60; // 2-hour minimum
            }
            
            // Plumbing
            if (document.getElementById('plumbing').checked) {
                const type = document.getElementById('plumbingType').value;
                const prices = { minor: 60, fixture: 120, drain: 90, major: 300 };
                baseTotal += prices[type] || 0;
            }
            
            // Exterior Painting
            if (document.getElementById('exteriorPainting').checked) {
                const size = document.getElementById('exteriorPaintSize').value;
                const prices = { trim: 300, small: 450, partial: 750, full: 1500 };
                baseTotal += prices[size] || 0;
            }
            
            // Wood Fence
            if (document.getElementById('woodFence').checked) {
                const length = parseInt(document.getElementById('fenceLength').value) || 50;
                const type = document.getElementById('fenceType').value;
                const rates = { basic: 20, standard: 25, premium: 30 };
                baseTotal += length * (rates[type] || 25);
            }
            
            // Tree Service
            if (document.getElementById('treeService').checked) {
                const type = document.getElementById('treeServiceType').value;
                const prices = { trimming: 120, shrubs: 180, removal: 300, major: 450 };
                baseTotal += prices[type] || 0;
            }
            
            // Flowerbeds
            if (document.getElementById('flowerbeds').checked) {
                const type = document.getElementById('flowerbedType').value;
                const prices = { maintenance: 60, refresh: 120, new: 210, multiple: 300 };
                baseTotal += prices[type] || 0;
            }
            
            // Mowing
            if (document.getElementById('mowing').checked) {
                const size = document.getElementById('lawnSize').value;
                const prices = { small: 60, medium: 75, large: 90, xlarge: 120 };
                let mowingPrice = prices[size] || 0;
                
                // Apply frequency discount
                const frequency = document.getElementById('mowingFrequency').value;
                if (frequency === 'weekly') {
                    mowingPrice *= 0.9; // 10% discount
                } else if (frequency === 'biweekly') {
                    mowingPrice *= 0.95; // 5% discount
                }
                
                baseTotal += mowingPrice;
            }
            
            // Yard Cleanup
            if (document.getElementById('yardCleanup').checked) {
                const scope = document.getElementById('cleanupScope').value;
                const prices = { light: 60, moderate: 150, heavy: 240 };
                baseTotal += prices[scope] || 0;
            }
            
            // Materials
            let materialsTotal = 0;
            if (document.getElementById('materials').checked) {
                materialsTotal = parseFloat(document.getElementById('materialsCost').value) || 0;
            }
            
            // Calculate totals
            let subtotal = baseTotal + materialsTotal;
            let urgentFee = 0;
            
            // Urgent service fee
            if (document.getElementById('urgent').checked) {
                urgentFee = Math.round(subtotal * 0.25);
                document.getElementById('urgentRow').style.display = 'flex';
            } else {
                document.getElementById('urgentRow').style.display = 'none';
            }
            
            const finalTotal = subtotal + urgentFee;
            
            // Update display
            document.getElementById('basePrice').textContent = '$' + baseTotal.toLocaleString();
            document.getElementById('materialsPrice').textContent = '$' + materialsTotal.toLocaleString();
            document.getElementById('urgentPrice').textContent = '$' + urgentFee.toLocaleString();
            document.getElementById('totalPrice').textContent = '$' + finalTotal.toLocaleString();
        }
        
        // Update itemized list
        function updateItemizedList() {
            const container = document.getElementById('itemizedContainer');
            const items = [];
            
            // Kitchen Cabinets
            if (document.getElementById('kitchenCabinets').checked) {
                const count = parseInt(document.getElementById('cabinetCount').value) || 5;
                const price = count * 40;
                items.push({ name: `Kitchen Cabinet Installation (${count} cabinets @ $40 each)`, price: price });
            }
            
            // Bathroom Work
            if (document.getElementById('bathroomWork').checked) {
                const type = document.getElementById('bathroomType').value;
                const prices = { minor: 60, moderate: 150, major: 300 };
                const labels = { 
                    minor: 'Minor Bathroom Repairs', 
                    moderate: 'Moderate Bathroom Updates', 
                    major: 'Major Bathroom Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Sheetrock
            if (document.getElementById('sheetrock').checked) {
                const size = document.getElementById('sheetrockSize').value;
                const prices = { small: 60, medium: 120, large: 240, wall: 360 };
                const labels = { 
                    small: 'Small Sheetrock Patch', 
                    medium: 'Medium Drywall Repair', 
                    large: 'Large Drywall Repair', 
                    wall: 'Full Wall Sheetrock' 
                };
                items.push({ name: labels[size], price: prices[size] });
            }
            
            // Interior Painting
            if (document.getElementById('interiorPainting').checked) {
                const area = document.getElementById('interiorPaintArea').value;
                const prices = { room: 180, tworooms: 300, multiple: 540, whole: 1080 };
                const labels = { 
                    room: 'Interior Painting - Single Room', 
                    tworooms: 'Interior Painting - Two Rooms', 
                    multiple: 'Interior Painting - Multiple Rooms', 
                    whole: 'Interior Painting - Whole House' 
                };
                items.push({ name: labels[area], price: prices[area] });
            }
            
            // Floodlights
            if (document.getElementById('floodlights').checked) {
                const count = parseInt(document.getElementById('floodlightCount').value) || 2;
                const price = count * 60;
                items.push({ name: `Floodlight Installation (${count} lights @ $60 each)`, price: price });
            }
            
            // Light Fixtures
            if (document.getElementById('lightFixtures').checked) {
                const count = parseInt(document.getElementById('fixtureCount').value) || 3;
                const price = count * 45;
                items.push({ name: `Light Fixture Installation (${count} fixtures @ $45 each)`, price: price });
            }
            
            // Switches
            if (document.getElementById('switches').checked) {
                const count = parseInt(document.getElementById('switchCount').value) || 2;
                const price = count * 30;
                items.push({ name: `Wall Switch Replacement (${count} switches @ $30 each)`, price: price });
            }
            
            // Outlets
            if (document.getElementById('outlets').checked) {
                const count = parseInt(document.getElementById('outletCount').value) || 2;
                const price = count * 30;
                items.push({ name: `Outlet Installation/Replacement (${count} outlets @ $30 each)`, price: price });
            }
            
            // Plumbing
            if (document.getElementById('plumbing').checked) {
                const type = document.getElementById('plumbingType').value;
                const prices = { minor: 60, fixture: 120, drain: 90, major: 300 };
                const labels = { 
                    minor: 'Minor Plumbing Repair', 
                    fixture: 'Plumbing Fixture Replacement', 
                    drain: 'Drain Cleaning/Repair', 
                    major: 'Major Plumbing Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Exterior Painting
            if (document.getElementById('exteriorPainting').checked) {
                const size = document.getElementById('exteriorPaintSize').value;
                const prices = { trim: 300, small: 450, partial: 750, full: 1500 };
                const labels = { 
                    trim: 'Exterior Painting - Trim/Accent', 
                    small: 'Exterior Painting - Small Structure', 
                    partial: 'Exterior Painting - Partial House', 
                    full: 'Exterior Painting - Full House' 
                };
                items.push({ name: labels[size], price: prices[size] });
            }
            
            // Wood Fence
            if (document.getElementById('woodFence').checked) {
                const length = parseInt(document.getElementById('fenceLength').value) || 50;
                const type = document.getElementById('fenceType').value;
                const rates = { basic: 20, standard: 25, premium: 30 };
                const labels = { basic: 'Basic', standard: 'Standard', premium: 'Premium' };
                const rate = rates[type] || 25;
                const price = length * rate;
                items.push({ name: `Wood Fence - ${labels[type]} (${length} ft @ $${rate}/ft)`, price: price });
            }
            
            // Tree Service
            if (document.getElementById('treeService').checked) {
                const type = document.getElementById('treeServiceType').value;
                const prices = { trimming: 120, shrubs: 180, removal: 300, major: 450 };
                const labels = { 
                    trimming: 'Tree Trimming', 
                    shrubs: 'Shrubs/Small Trees Service', 
                    removal: 'Small Tree Removal', 
                    major: 'Major Tree Work' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Flowerbeds
            if (document.getElementById('flowerbeds').checked) {
                const type = document.getElementById('flowerbedType').value;
                const prices = { maintenance: 60, refresh: 120, new: 210, multiple: 300 };
                const labels = { 
                    maintenance: 'Flowerbed Maintenance', 
                    refresh: 'Flowerbed Refresh', 
                    new: 'New Flowerbed Installation', 
                    multiple: 'Multiple Flowerbeds' 
                };
                items.push({ name: labels[type], price: prices[type] });
            }
            
            // Mowing
            if (document.getElementById('mowing').checked) {
                const size = document.getElementById('lawnSize').value;
                const prices = { small: 60, medium: 75, large: 90, xlarge: 120 };
                const labels = { 
                    small: 'Lawn Mowing - Small Yard', 
                    medium: 'Lawn Mowing - Medium Yard', 
                    large: 'Lawn Mowing - Large Yard', 
                    xlarge: 'Lawn Mowing - Extra Large Yard' 
                };
                let mowingPrice = prices[size] || 0;
                const frequency = document.getElementById('mowingFrequency').value;
                let freqLabel = '';
                
                if (frequency === 'weekly') {
                    mowingPrice *= 0.9;
                    freqLabel = ' (Weekly - 10% discount)';
                } else if (frequency === 'biweekly') {
                    mowingPrice *= 0.95;
                    freqLabel = ' (Bi-Weekly - 5% discount)';
                }
                
                items.push({ name: labels[size] + freqLabel, price: Math.round(mowingPrice) });
            }
            
            // Yard Cleanup
            if (document.getElementById('yardCleanup').checked) {
                const scope = document.getElementById('cleanupScope').value;
                const prices = { light: 60, moderate: 150, heavy: 240 };
                const labels = { 
                    light: 'Light Yard Cleanup', 
                    moderate: 'Moderate Yard Cleanup', 
                    heavy: 'Heavy Yard Cleanup' 
                };
                items.push({ name: labels[scope], price: prices[scope] });
            }
            
            // Materials
            if (document.getElementById('materials').checked) {
                const cost = parseFloat(document.getElementById('materialsCost').value) || 0;
                if (cost > 0) {
                    items.push({ name: 'Materials (estimated)', price: cost });
                }
            }
            
            // Urgent Fee
            if (document.getElementById('urgent').checked && items.length > 0) {
                const subtotal = items.reduce((sum, item) => sum + item.price, 0);
                const urgentFee = Math.round(subtotal * 0.25);
                items.push({ name: '🚨 Urgent Service Fee (+25%)', price: urgentFee });
            }
            
            // Display items
            if (items.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">Select services above to see itemized breakdown</div>';
            } else {
                container.innerHTML = items.map(item => `
                    <div class="itemized-item">
                        <span class="item-name">${item.name}</span>
                        <span class="item-price">$${item.price.toLocaleString()}</span>
                    </div>
                `).join('');
            }
        }
        
        // Initialize
        calculatePrice();
        updateItemizedList();
        
        // Initialize FREE Address Autocomplete (no API key needed!)
        // Uses saved addresses from previous submissions
        function initAddressAutocomplete() {
            const input = document.getElementById('serviceAddress');
            const datalist = document.createElement('datalist');
            datalist.id = 'addressSuggestions';
            input.setAttribute('list', 'addressSuggestions');
            input.parentNode.insertBefore(datalist, input.nextSibling);
            
            // Load saved addresses from localStorage
            const savedAddresses = JSON.parse(localStorage.getItem('rapidoAddresses') || '[]');
            savedAddresses.forEach(addr => {
                const option = document.createElement('option');
                option.value = addr;
                datalist.appendChild(option);
            });
            
            // Add common Lawton, OK areas as suggestions
            const commonAreas = [
                'Lawton, OK',
                'Fort Sill, OK',
                'Cache, OK',
                'Elgin, OK',
                'Medicine Park, OK'
            ];
            
            commonAreas.forEach(area => {
                if (!savedAddresses.includes(area)) {
                    const option = document.createElement('option');
                    option.value = area;
                    datalist.appendChild(option);
                }
            });
        }
        
        // Save address to history when form is submitted
        function saveAddressToHistory(address) {
            if (address && address.trim()) {
                const savedAddresses = JSON.parse(localStorage.getItem('rapidoAddresses') || '[]');
                if (!savedAddresses.includes(address)) {
                    savedAddresses.unshift(address); // Add to beginning
                    // Keep only last 20 addresses
                    if (savedAddresses.length > 20) {
                        savedAddresses.pop();
                    }
                    localStorage.setItem('rapidoAddresses', JSON.stringify(savedAddresses));
                }
            }
        }
        
        // Initialize on page load
        initAddressAutocomplete();
        
        // Auto-update on changes
        document.getElementById('quoteForm').addEventListener('change', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        document.getElementById('quoteForm').addEventListener('input', function() {
            calculatePrice();
            updateItemizedList();
        });
        
        // Form submission
        document.getElementById('quoteForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            
            // Hide messages
            successMsg.classList.remove('show');
            errorMsg.classList.remove('show');
            
            // Validate
            const clientName = document.getElementById('clientName').value.trim();
            const clientEmail = document.getElementById('clientEmail').value.trim();
            const projectName = document.getElementById('projectName').value.trim();
            
            if (!clientName || !clientEmail || !projectName) {
                document.getElementById('errorText').textContent = 'Please fill in all required fields (*)';
                errorMsg.classList.add('show');
                return;
            }
            
            // Disable button
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading-spinner"></div> Submitting...';
            
            try {
                // Check Firebase connection
                if (!database) {
                    throw new Error('Firebase not initialized. Please check your configuration.');
                }
                
                // Generate invoice number
                const now = new Date();
                const year = String(now.getFullYear()).slice(-2);
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const invoiceNumber = `RAPIDO-${year}${month}${day}-${hours}${minutes}`;
                
                // Build services description
                const services = [];
                
                if (document.getElementById('kitchenCabinets').checked) {
                    const count = document.getElementById('cabinetCount').value;
                    services.push(`Kitchen Cabinet Installation - ${count} cabinets`);
                }
                if (document.getElementById('bathroomWork').checked) {
                    const type = document.getElementById('bathroomType').value;
                    services.push(`Bathroom Work - ${type}`);
                }
                if (document.getElementById('sheetrock').checked) {
                    const size = document.getElementById('sheetrockSize').value;
                    services.push(`Sheetrock Repair - ${size}`);
                }
                if (document.getElementById('interiorPainting').checked) {
                    const area = document.getElementById('interiorPaintArea').value;
                    services.push(`Interior Painting - ${area}`);
                }
                if (document.getElementById('floodlights').checked) {
                    const count = document.getElementById('floodlightCount').value;
                    services.push(`Floodlight Installation - ${count} lights`);
                }
                if (document.getElementById('lightFixtures').checked) {
                    const count = document.getElementById('fixtureCount').value;
                    services.push(`Light Fixtures - ${count} fixtures`);
                }
                if (document.getElementById('switches').checked) {
                    const count = document.getElementById('switchCount').value;
                    services.push(`Wall Switches - ${count} switches`);
                }
                if (document.getElementById('outlets').checked) {
                    const count = document.getElementById('outletCount').value;
                    services.push(`Outlets - ${count} outlets`);
                }
                if (document.getElementById('plumbing').checked) {
                    const type = document.getElementById('plumbingType').value;
                    services.push(`Plumbing - ${type}`);
                }
                if (document.getElementById('exteriorPainting').checked) {
                    const size = document.getElementById('exteriorPaintSize').value;
                    services.push(`Exterior Painting - ${size}`);
                }
                if (document.getElementById('woodFence').checked) {
                    const length = document.getElementById('fenceLength').value;
                    const type = document.getElementById('fenceType').value;
                    services.push(`Wood Fence - ${length}ft ${type}`);
                }
                if (document.getElementById('treeService').checked) {
                    const type = document.getElementById('treeServiceType').value;
                    services.push(`Tree Service - ${type}`);
                }
                if (document.getElementById('flowerbeds').checked) {
                    const type = document.getElementById('flowerbedType').value;
                    services.push(`Flowerbed Work - ${type}`);
                }
                if (document.getElementById('mowing').checked) {
                    const size = document.getElementById('lawnSize').value;
                    const freq = document.getElementById('mowingFrequency').value;
                    services.push(`Lawn Mowing - ${size} yard, ${freq}`);
                }
                if (document.getElementById('yardCleanup').checked) {
                    const scope = document.getElementById('cleanupScope').value;
                    services.push(`Yard Cleanup - ${scope}`);
                }
                if (document.getElementById('materials').checked) {
                    const cost = document.getElementById('materialsCost').value;
                    services.push(`Materials needed - $${cost} estimated`);
                }
                
                const isUrgent = document.getElementById('urgent').checked;
                const urgentText = isUrgent ? '\n\n🚨 URGENT SERVICE REQUESTED (+25%)\nNext Day Service Required' : '';
                
                const description = [
                    document.getElementById('projectDescription').value || '',
                    '',
                    'Services Requested:',
                    ...services.map(s => `• ${s}`),
                    urgentText,
                    '',
                    `Client Phone: ${document.getElementById('clientPhone').value || 'Not provided'}`,
                    `Service Address: ${document.getElementById('serviceAddress').value || 'Not provided'}`,
                    `Client Email: ${clientEmail}`
                ].filter(Boolean).join('\n');
                
                // Prepare data for Firebase
                const quoteData = {
                    task: projectName,
                    clientName: clientName,
                    address: document.getElementById('serviceAddress').value || '',
                    person: '',
                    status: 'Pending',
                    priority: isUrgent ? 'High' : 'Medium',
                    requestDate: new Date().toISOString().split('T')[0],
                    dueDate: '',
                    actualWorkHours: '0',
                    workHours: '0',
                    notes: description,
                    invoiceNumber: invoiceNumber,
                    totalPrice: document.getElementById('totalPrice').textContent.replace(/,/g, ''),
                    timeline: '',
                    source: 'RAPIDO Handyman Quote Form',
                    submittedAt: firebase.database.ServerValue.TIMESTAMP
                };
                
                // Submit to Firebase
                const requestRef = database.ref('requests').push();
                await requestRef.set(quoteData);
                
                // Save address to history for future autocomplete
                saveAddressToHistory(document.getElementById('serviceAddress').value);
                
                // Success
                successMsg.classList.add('show');
                submitBtn.innerHTML = '✓ Submitted!';
                
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
                document.querySelector('.container').scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Reset form after delay
                setTimeout(() => {
                    if (confirm('Submit another quote request?')) {
                        location.reload();
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Submission error:', error);
                document.getElementById('errorText').textContent = `Error: ${error.message}`;
                errorMsg.classList.add('show');
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Request';
            }
        });
    </script>
</body>
</html>
